<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Mercado Livre - Publicar Anúncio com Login OAuth</title>
    <style>
      /* Variáveis de Cor e Fontes */
      :root {
        --primary-color: #145da0;
        --secondary-color: #4a90e2;
        --accent-color: #8dd08d;
        --error-color: #f08080;
        --background-gradient: linear-gradient(135deg, var(--secondary-color), var(--primary-color));
        --font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      }
      /* Reset e Estilos Básicos */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      body {
        font-family: var(--font-family);
        background: var(--background-gradient);
        color: #333;
        min-height: 100vh;
        padding: 20px;
        line-height: 1.6;
        animation: fadeInPage 1.5s ease-out;
      }
      @keyframes fadeInPage {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      header {
        text-align: center;
        margin-bottom: 2rem;
        color: #fff;
      }
      header h1 {
        font-size: 2.8rem;
        margin-bottom: 0.3rem;
        text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.3);
      }
      header p {
        font-size: 1.2rem;
      }
      /* Containers */
      .container {
        background-color: #fff;
        border-radius: 12px;
        padding: 2rem;
        max-width: 900px;
        width: 100%;
        margin: 0 auto 2rem;
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
        transition: transform 0.3s ease;
        animation: fadeInContainer 1s ease-out;
      }
      @keyframes fadeInContainer {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      h2 {
        margin-bottom: 1.5rem;
        color: var(--primary-color);
        border-bottom: 2px solid var(--secondary-color);
        padding-bottom: 0.3rem;
      }
      .form-row {
        margin-bottom: 1rem;
      }
      label {
        display: block;
        margin-bottom: 0.3rem;
        font-weight: bold;
        color: var(--primary-color);
      }
      input[type="text"],
      input[type="number"],
      input[type="file"],
      select,
      textarea {
        width: 100%;
        padding: 0.6rem;
        border: 1px solid #ccc;
        border-radius: 6px;
        transition: border-color 0.3s ease;
      }
      input:focus,
      textarea:focus,
      select:focus {
        outline: none;
        border-color: var(--primary-color);
      }
      fieldset {
        border: 1px solid #ddd;
        padding: 1rem;
        border-radius: 8px;
        margin-bottom: 1.5rem;
      }
      legend {
        padding: 0 0.5rem;
        font-size: 1.1rem;
        font-weight: bold;
        color: var(--primary-color);
      }
      .btn {
        display: inline-block;
        background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
        color: #fff;
        padding: 0.75rem 1.5rem;
        border: none;
        border-radius: 30px;
        cursor: pointer;
        font-size: 1rem;
        transition: background 0.3s ease, transform 0.2s ease, box-shadow 0.2s ease;
        text-decoration: none;
        margin-top: 0.5rem;
      }
      .btn:hover {
        background: linear-gradient(135deg, var(--secondary-color), var(--primary-color));
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0,0,0,0.2);
      }
      .checkbox-group label {
        font-weight: normal;
        margin-right: 1rem;
      }
      .hidden {
        display: none;
      }
      .message {
        margin: 1rem 0;
        padding: 0.75rem;
        border-radius: 8px;
        background-color: #e0f8e9;
        border: 1px solid var(--accent-color);
        color: #2e7d32;
      }
      .error {
        background-color: #fce8e6;
        border: 1px solid var(--error-color);
        color: var(--error-color);
      }
      footer {
        text-align: center;
        color: #fff;
        margin-top: 2rem;
      }
      /* Modal for Vehicle Selection */
      .modal {
        display: none;
        position: fixed;
        z-index: 100;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow-y: auto;
        background-color: rgba(0, 0, 0, 0.5);
        padding-top: 60px;
      }
      .modal-content {
        background: #fff;
        margin: 5% auto;
        padding: 2rem;
        border: 1px solid #888;
        width: 90%;
        max-width: 800px;
        border-radius: 12px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.3);
      }
      .close {
        color: #aaa;
        float: right;
        font-size: 28px;
        font-weight: bold;
        cursor: pointer;
      }
      .close:hover {
        color: #000;
      }
      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 1rem;
      }
      th, td {
        padding: 0.5rem;
        border: 1px solid #ccc;
        text-align: left;
      }
      th {
        background: #f2f2f2;
      }
    </style>
  </head>
  <body>
    <header>
      <h1>Mercado Livre - Publicar Anúncio</h1>
      <p>Integrando Login OAuth com funcionalidades avançadas</p>
    </header>

    <!-- LOGIN SECTION -->
    <div class="container" id="loginContainer">
      <div id="message" class="message hidden"></div>
      <button id="btnLogin" class="btn">Login com Mercado Livre</button>
      <!-- Test Login Button (without Mercado Livre account) -->
      <button id="btnTestLogin" class="btn">Login de Teste (Sem conta)</button>
      <div id="authCodeSection" class="hidden">
        <p>Se o redirecionamento não funcionar, cole o código de autorização:</p>
        <input type="text" id="authCodeInput" placeholder="Código de autorização" />
        <button id="btnTrocar" class="btn">Trocar Código por Token</button>
      </div>
      <div id="loginStatus" class="hidden" style="margin-top: 1rem;">
        <p><strong>Logado com sucesso!</strong></p>
        <p id="userData"></p>
      </div>
    </div>

    <!-- MAIN APPLICATION: Visible only after login -->
    <div class="container hidden" id="appContainer">
      <h2>Criar Anúncio Único</h2>
      <form id="formCriarAnuncio">
        <!-- Tipo de Artigo (padrão: Produtos) -->
        <div class="form-row">
          <label for="primaryCategory">Tipo de Artigo:</label>
          <select id="primaryCategory">
            <option value="Produtos" selected>Produtos</option>
            <option value="Veiculos">Veículos</option>
            <option value="Imoveis">Imóveis</option>
            <option value="Servicos">Serviços</option>
          </select>
        </div>
        <!-- Nome do Produto -->
        <div class="form-row">
          <label for="createTitle">Nome do Produto:</label>
          <input type="text" id="createTitle" placeholder="Digite o nome do produto" required />
        </div>
        <!-- Automatic Category Fetch -->
        <div class="form-row" id="automaticCategoriesContainer">
          <p style="color: var(--primary-color); font-weight: bold;">Categorias automáticas:</p>
          <div class="checkbox-group" id="siteCategories">
            <!-- Categories will be populated here automatically -->
          </div>
        </div>
        <!-- Marca e Número da Peça -->
        <div class="form-row">
          <label for="createBrand">Marca:</label>
          <input type="text" id="createBrand" placeholder="Digite a marca" required />
        </div>
        <div class="form-row">
          <label for="createPartNumber">Número da Peça:</label>
          <input type="text" id="createPartNumber" placeholder="Digite o número da peça" required />
        </div>
        <!-- Estado do Artigo -->
        <div class="form-row">
          <label for="itemCondition">Condição do Artigo:</label>
          <select id="itemCondition">
            <option value="new">Novo</option>
            <option value="used">Usado</option>
          </select>
        </div>
        <!-- Código de Etiqueta (automático: Sem código) -->
        <div class="form-row">
          <label>Código de Etiqueta:</label>
          <label><input type="radio" name="etiqueta" value="none" checked /> Sem código</label>
        </div>
        <!-- Código INMETRO -->
        <div class="form-row">
          <label for="inmetroCode">Código INMETRO:</label>
          <input type="text" id="inmetroCode" placeholder="Clique em 'Gerar Código'" readonly />
          <button type="button" id="btnGenerateInmetro" class="btn">Gerar Código INMETRO</button>
        </div>
        <!-- Características Secundárias -->
        <fieldset>
          <legend>Características Secundárias</legend>
          <div class="form-row">
            <label for="vehicleType">Tipo de Veículo:</label>
            <input type="text" id="vehicleType" placeholder="Ex: Carro, Moto, etc." />
          </div>
          <div class="form-row">
            <label for="vehiclePositions">Posições:</label>
            <input type="text" id="vehiclePositions" placeholder="Ex: Frente, Traseira, etc." />
          </div>
          <div class="form-row checkbox-group">
            <label><input type="checkbox" id="includesCoxins" /> Inclui Coxins</label>
            <label><input type="checkbox" id="includesBatentes" /> Inclui Batentes</label>
            <label><input type="checkbox" id="includesMolas" /> Inclui Molas</label>
          </div>
          <div class="form-row">
            <label for="oemCode">Código OEM:</label>
            <input type="text" id="oemCode" placeholder="Digite o Código OEM" />
          </div>
          <!-- Botão para Selecionar Veículos -->
          <div class="form-row">
            <button type="button" id="btnSelecionarVeiculos" class="btn">Selecionar Veículos</button>
          </div>
        </fieldset>
        <!-- Informações Finais do Anúncio -->
        <div class="form-row">
          <label for="createPrice">Preço (R$):</label>
          <input type="number" id="createPrice" placeholder="Digite o preço" required step="0.01" />
        </div>
        <div class="form-row">
          <label for="createQuantity">Quantidade:</label>
          <input type="number" id="createQuantity" placeholder="Quantidade" value="1" />
        </div>
        <div class="form-row">
          <label for="createDescription">Descrição:</label>
          <textarea id="createDescription" placeholder="Descrição detalhada do anúncio" required rows="4"></textarea>
        </div>
        <div class="form-row">
          <label for="createImages">Imagens:</label>
          <input type="file" id="createImages" multiple accept="image/*" />
        </div>
        <button type="submit" class="btn">Criar Anúncio</button>
      </form>
      <div id="createAnuncioResult" style="margin-top:1rem;"></div>

      <h2>Publicar Vários Anúncios</h2>
      <button id="btnAdicionarAnuncio" class="btn">Adicionar Formulário de Anúncio</button>
      <div id="anuncioFormsContainer"></div>
      <div class="form-row">
        <label for="guaranteeTime">Tempo de Garantia (meses):</label>
        <input type="number" id="guaranteeTime" placeholder="Ex.: 12" value="0" />
      </div>
      <button id="btnPublicarVarios" class="btn">Publicar Todos</button>
      <div id="resultMultiple" style="margin-top:1rem;"></div>
    </div>

    <!-- Modal para Seleção de Veículos -->
    <div id="modalVeiculos" class="modal">
      <div class="modal-content">
        <span class="close" id="closeModal">&times;</span>
        <h2>Selecionar Veículos</h2>
        <fieldset>
          <legend>Filtros de Veículos</legend>
          <div class="form-row">
            <label for="filterMarca">Marca:</label>
            <input type="text" id="filterMarca" placeholder="Digite a marca" />
          </div>
          <div class="form-row">
            <label for="filterModelo">Modelo:</label>
            <input type="text" id="filterModelo" placeholder="Digite o modelo" />
          </div>
          <div class="form-row">
            <label for="filterAno">Ano:</label>
            <input type="number" id="filterAno" placeholder="Ano" />
          </div>
          <div class="form-row">
            <label for="filterVersao">Versão:</label>
            <input type="text" id="filterVersao" placeholder="Versão" />
          </div>
          <div class="form-row">
            <label for="filterMotor">Motor:</label>
            <input type="text" id="filterMotor" placeholder="Motor" />
          </div>
          <div class="form-row">
            <label for="filterCombustivel">Combustível:</label>
            <input type="text" id="filterCombustivel" placeholder="Combustível" />
          </div>
          <div class="form-row">
            <label for="filterPotencia">Potência:</label>
            <input type="text" id="filterPotencia" placeholder="Potência" />
          </div>
          <div class="form-row">
            <label for="filterCarroceria">Carroceria:</label>
            <input type="text" id="filterCarroceria" placeholder="Carroceria" />
          </div>
          <div class="form-row">
            <label for="filterTransmissao">Transmissão:</label>
            <input type="text" id="filterTransmissao" placeholder="Transmissão" />
          </div>
          <div class="form-row">
            <label for="filterCambio">Câmbio:</label>
            <input type="text" id="filterCambio" placeholder="Câmbio" />
          </div>
          <div class="form-row">
            <label for="filterPortas">Portas:</label>
            <input type="number" id="filterPortas" placeholder="Portas" />
          </div>
          <div class="form-row">
            <label for="filterDirecao">Direção:</label>
            <input type="text" id="filterDirecao" placeholder="Direção" />
          </div>
          <div class="form-row">
            <label for="filterTracao">Tração:</label>
            <input type="text" id="filterTracao" placeholder="Tração" />
          </div>
          <div class="form-row">
            <label for="filterValvulas">Válvulas:</label>
            <input type="number" id="filterValvulas" placeholder="Válvulas" />
          </div>
          <button id="btnFiltrarVeiculos" class="btn">Filtrar Veículos</button>
        </fieldset>
        <h3>Lista de Veículos</h3>
        <table id="tabelaVeiculos">
          <thead>
            <tr>
              <th>Marca</th>
              <th>Modelo</th>
              <th>Ano</th>
              <th>Versão</th>
              <th>Motor</th>
              <th>Combustível</th>
              <th>Potência</th>
              <th>Carroceria</th>
              <th>Transmissão</th>
              <th>Câmbio</th>
              <th>Portas</th>
              <th>Direção</th>
              <th>Tração</th>
              <th>Válvulas</th>
            </tr>
          </thead>
          <tbody id="bodyVeiculos">
            <!-- Dados dos veículos serão carregados dinamicamente -->
          </tbody>
        </table>
      </div>
    </div>

    <footer>
      <p>© 2025 Mercado Livre Integration Demo</p>
    </footer>

    <script>
      // OAuth and API Configurations
      const CLIENT_ID = "SEU_CLIENT_ID";
      const CLIENT_SECRET = "SEU_CLIENT_SECRET"; // WARNING: Do not expose in production frontend.
      const REDIRECT_URI = window.location.origin;
      const AUTHORIZATION_URL = "https://auth.mercadolivre.com.br/authorization";
      const TOKEN_URL = "https://api.mercadolivre.com/oauth/token";
      let ACCESS_TOKEN = "";
      let SELLER_ID = "";
      const API_BASE = "https://api.mercadolibre.com";

      // Function to show messages to the user
      function showMessage(msg, isError = false) {
        const messageEl = document.getElementById("message");
        messageEl.innerText = msg;
        messageEl.className = isError ? "message error" : "message";
        messageEl.classList.remove("hidden");
      }

      // OAuth functions
      function iniciarAutenticacao() {
        const params = new URLSearchParams({
          response_type: "code",
          client_id: CLIENT_ID,
          redirect_uri: REDIRECT_URI
        });
        const authUrl = `${AUTHORIZATION_URL}?${params.toString()}`;
        window.open(authUrl, "_blank");
        showMessage("Uma nova janela foi aberta para login. Após autorizar, insira o código se necessário.");
        document.getElementById("authCodeSection").classList.remove("hidden");
      }

      function trocarCodigoPorToken(codigo) {
        const payload = new URLSearchParams({
          grant_type: "authorization_code",
          client_id: CLIENT_ID,
          client_secret: CLIENT_SECRET,
          code: codigo,
          redirect_uri: REDIRECT_URI
        });
        fetch(TOKEN_URL, {
          method: "POST",
          headers: { "Content-Type": "application/x-www-form-urlencoded" },
          body: payload.toString()
        })
          .then(response => response.json())
          .then(data => {
            if (data.access_token) {
              ACCESS_TOKEN = data.access_token;
              SELLER_ID = data.user_id;
              showMessage("Autenticação realizada com sucesso!");
              document.getElementById("authCodeSection").classList.add("hidden");
              document.getElementById("btnLogin").classList.add("hidden");
              document.getElementById("btnTestLogin").classList.add("hidden");
              document.getElementById("loginStatus").classList.remove("hidden");
              document.getElementById("userData").innerText = `Access Token: ${ACCESS_TOKEN} | Seller ID: ${SELLER_ID}`;
              document.getElementById("appContainer").classList.remove("hidden");
            } else {
              showMessage("Erro na troca de código por token: " + JSON.stringify(data), true);
            }
          })
          .catch(error => showMessage("Erro: " + error, true));
      }

      function checkForAuthCode() {
        const urlParams = new URLSearchParams(window.location.search);
        const code = urlParams.get("code");
        if (code) {
          showMessage("Código de autorização detectado. Realizando troca...");
          trocarCodigoPorToken(code);
          window.history.replaceState({}, document.title, window.location.pathname);
        }
      }

      // Test Login Functionality (without using a Mercado Livre account)
      function testLogin() {
        ACCESS_TOKEN = "TEST_TOKEN";
        SELLER_ID = "TEST_SELLER";
        showMessage("Login de teste realizado com sucesso!");
        document.getElementById("btnLogin").classList.add("hidden");
        document.getElementById("btnTestLogin").classList.add("hidden");
        document.getElementById("authCodeSection").classList.add("hidden");
        document.getElementById("loginStatus").classList.remove("hidden");
        document.getElementById("userData").innerText = `Access Token: ${ACCESS_TOKEN} | Seller ID: ${SELLER_ID}`;
        document.getElementById("appContainer").classList.remove("hidden");
      }

      // Event Listeners for OAuth and Test Login
      document.getElementById("btnLogin").addEventListener("click", iniciarAutenticacao);
      document.getElementById("btnTrocar").addEventListener("click", () => {
        const codeInput = document.getElementById("authCodeInput").value.trim();
        if (codeInput) {
          trocarCodigoPorToken(codeInput);
        } else {
          showMessage("Por favor, insira o código de autorização.", true);
        }
      });
      document.getElementById("btnTestLogin").addEventListener("click", testLogin);
      window.onload = checkForAuthCode;

      // Function to simulate fetching automatic categories from Mercado Livre based on product name.
      function fetchAutomaticCategories(productName) {
        // In a real scenario, here you would call the Mercado Livre API to get automatic categories.
        // For simulation, we'll use a dummy promise.
        return new Promise((resolve) => {
          setTimeout(() => {
            // Simulated categories based on product name:
            let categories = [];
            if (productName.toLowerCase().includes("computador")) {
              categories = ["Informática", "Eletrônicos", "Hardware"];
            } else if (productName.toLowerCase().includes("celular")) {
              categories = ["Eletrônicos", "Telefonia", "Acessórios"];
            } else {
              categories = ["Geral", "Outros"];
            }
            resolve(categories);
          }, 500);
        });
      }

      // Event listener on product name input to fetch automatic categories.
      document.getElementById("createTitle").addEventListener("blur", function () {
        const productName = this.value.trim();
        if (productName) {
          fetchAutomaticCategories(productName).then((categories) => {
            const container = document.getElementById("siteCategories");
            container.innerHTML = "";
            categories.forEach((cat) => {
              const label = document.createElement("label");
              label.innerHTML = `<input type="checkbox" class="site-category" value="${cat}" checked /> ${cat}`;
              container.appendChild(label);
            });
          });
        }
      });

      // Functions for Creating Announcements
      document.getElementById("formCriarAnuncio").addEventListener("submit", function (e) {
        e.preventDefault();
        const titulo = document.getElementById("createTitle").value;
        const preco = parseFloat(document.getElementById("createPrice").value);
        const quantidade = parseInt(document.getElementById("createQuantity").value) || 1;
        const descricao = document.getElementById("createDescription").value;
        const primaryCategory = document.getElementById("primaryCategory").value;
        let siteCategories = [];
        document.querySelectorAll(".site-category").forEach((cb) => {
          if (cb.checked) siteCategories.push(cb.value);
        });
        const marca = document.getElementById("createBrand").value;
        const partNumber = document.getElementById("createPartNumber").value;
        const extraFields = {
          marca: marca,
          partNumber: partNumber,
          inmetroCode: document.getElementById("inmetroCode").value,
          vehicleType: document.getElementById("vehicleType").value,
          positions: document.getElementById("vehiclePositions").value,
          includesCoxins: document.getElementById("includesCoxins").checked,
          includesBatentes: document.getElementById("includesBatentes").checked,
          includesMolas: document.getElementById("includesMolas").checked,
          oemCode: document.getElementById("oemCode").value,
          siteCategories: siteCategories,
          primaryCategory: primaryCategory
        };
        const imagesFiles = document.getElementById("createImages").files;
        const imagensPromises = [];
        for (let i = 0; i < imagesFiles.length; i++) {
          imagensPromises.push(enviarImagemMercadoLivre(imagesFiles[i]));
        }
        Promise.all(imagensPromises).then((imagens) => {
          criarAnuncio(titulo, preco, extraFields.primaryCategory, descricao, quantidade, imagens, extraFields)
            .then((response) => response.json())
            .then((data) => {
              if (data.id) {
                document.getElementById("createAnuncioResult").innerText = "Anúncio criado com sucesso! ID: " + data.id;
              } else {
                document.getElementById("createAnuncioResult").innerText = "Erro ao criar anúncio: " + JSON.stringify(data);
              }
            });
        });
      });

      function criarAnuncio(titulo, preco, categoria_id, descricao, quantidade = 1, imagens = [], extraFields = {}) {
        const payload = {
          title: titulo,
          price: preco,
          currency_id: "BRL",
          available_quantity: quantidade,
          buying_mode: "buy_it_now",
          listing_type_id: "gold_pro",
          condition: document.getElementById("itemCondition").value,
          category_id: categoria_id,
          description: { plain_text: descricao },
          pictures: imagens.map((src) => ({ source: src })),
          extra: extraFields
        };
        const url = `${API_BASE}/items?access_token=${ACCESS_TOKEN}`;
        return fetch(url, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });
      }

      function enviarImagemMercadoLivre(file) {
        const url = `${API_BASE}/pictures?access_token=${ACCESS_TOKEN}`;
        const formData = new FormData();
        formData.append("file", file, file.name);
        return fetch(url, { method: "POST", body: formData })
          .then((response) => response.json())
          .then((data) => {
            if (data.secure_url) return data.secure_url;
            else {
              showMessage("Falha no upload da imagem: " + JSON.stringify(data), true);
              return null;
            }
          });
      }

      // Publicar Vários Anúncios
      const anuncioFormsContainer = document.getElementById("anuncioFormsContainer");
      document.getElementById("btnAdicionarAnuncio").addEventListener("click", () => {
        const formDiv = document.createElement("div");
        formDiv.className = "announcement-form";
        formDiv.style.border = "1px solid #ccc";
        formDiv.style.padding = "1rem";
        formDiv.style.borderRadius = "8px";
        formDiv.style.marginBottom = "1.5rem";
        formDiv.innerHTML = `
          <div class="form-row">
            <label>Título:</label>
            <input type="text" class="multi-title" placeholder="Título" required />
          </div>
          <div class="form-row">
            <label>Preço:</label>
            <input type="number" class="multi-price" placeholder="Preço" required step="0.01" />
          </div>
          <div class="form-row">
            <label>Categoria ID:</label>
            <input type="text" class="multi-category" placeholder="Categoria ID" required />
          </div>
          <div class="form-row">
            <label>Descrição:</label>
            <textarea class="multi-description" placeholder="Descrição" required rows="3"></textarea>
          </div>
          <div class="form-row">
            <label>Quantidade:</label>
            <input type="number" class="multi-quantity" placeholder="Quantidade" value="1" required />
          </div>
          <div class="form-row">
            <label>Imagens:</label>
            <input type="file" class="multi-images" multiple accept="image/*" />
          </div>
          <div class="form-row">
            <label>Tempo de Garantia (meses):</label>
            <input type="number" class="multi-guarantee" placeholder="Garantia" value="0" required />
          </div>
        `;
        anuncioFormsContainer.appendChild(formDiv);
      });

      async function publishMultipleAnnouncements() {
        const results = [];
        const forms = document.querySelectorAll(".announcement-form");
        for (const form of forms) {
          const titulo = form.querySelector(".multi-title").value;
          const preco = parseFloat(form.querySelector(".multi-price").value);
          const categoria_id = form.querySelector(".multi-category").value;
          const descricao = form.querySelector(".multi-description").value;
          const quantidade = parseInt(form.querySelector(".multi-quantity").value) || 1;
          const guarantee = form.querySelector(".multi-guarantee").value;
          const imagesInput = form.querySelector(".multi-images");
          const imagensPromises = [];
          for (let i = 0; i < imagesInput.files.length; i++) {
            imagensPromises.push(enviarImagemMercadoLivre(imagesInput.files[i]));
          }
          const imagens = await Promise.all(imagensPromises);
          try {
            const response = await criarAnuncio(
              titulo,
              preco,
              categoria_id,
              descricao,
              quantidade,
              imagens,
              { guarantee: guarantee }
            );
            const data = await response.json();
            results.push(data);
          } catch (err) {
            results.push({ error: err.message });
          }
        }
        return results;
      }

      document.getElementById("btnPublicarVarios").addEventListener("click", async () => {
        document.getElementById("resultMultiple").innerText = "Publicando anúncios...";
        const results = await publishMultipleAnnouncements();
        let successCount = 0;
        let failureCount = 0;
        results.forEach((res) => {
          if (res.id) successCount++;
          else failureCount++;
        });
        document.getElementById("resultMultiple").innerText = "Sucesso: " + successCount + " | Falhas: " + failureCount;
      });

      // Modal: Seleção de Veículos
      const modal = document.getElementById("modalVeiculos");
      const btnSelecionarVeiculos = document.getElementById("btnSelecionarVeiculos");
      const spanClose = document.getElementById("closeModal");
      btnSelecionarVeiculos.addEventListener("click", () => {
        modal.style.display = "block";
        carregarVeiculos();
      });
      spanClose.addEventListener("click", () => {
        modal.style.display = "none";
      });
      window.addEventListener("click", (event) => {
        if (event.target == modal) modal.style.display = "none";
      });
      function carregarVeiculos() {
        // Simulated data from Mercado Livre API
        const veiculos = [
          { marca: "Ford", modelo: "Fiesta", ano: "2015", versao: "1.6 SE", motor: "1.6", combustivel: "Gasolina", potencia: "115cv", carroceria: "Hatch", transmissao: "Automática", cambio: "Powershift", portas: "4", direcao: "Hidráulica", tracao: "Dianteira", valvulas: "16" },
          { marca: "Chevrolet", modelo: "Onix", ano: "2020", versao: "LTZ", motor: "1.0 Turbo", combustivel: "Gasolina/Etanol", potencia: "116cv", carroceria: "Hatch", transmissao: "Automática", cambio: "6 marchas", portas: "4", direcao: "Elétrica", tracao: "Dianteira", valvulas: "12" }
        ];
        const tbody = document.getElementById("bodyVeiculos");
        tbody.innerHTML = "";
        veiculos.forEach((v) => {
          const tr = document.createElement("tr");
          tr.innerHTML = `<td>${v.marca}</td>
                          <td>${v.modelo}</td>
                          <td>${v.ano}</td>
                          <td>${v.versao}</td>
                          <td>${v.motor}</td>
                          <td>${v.combustivel}</td>
                          <td>${v.potencia}</td>
                          <td>${v.carroceria}</td>
                          <td>${v.transmissao}</td>
                          <td>${v.cambio}</td>
                          <td>${v.portas}</td>
                          <td>${v.direcao}</td>
                          <td>${v.tracao}</td>
                          <td>${v.valvulas}</td>`;
          tbody.appendChild(tr);
        });
      }
    </script>
  </body>
</html>
